# GitHub Actions Virtual Environments
# https://github.com/actions/virtual-environments/

# Automatically labels a pull request as "stacked PR" if it is stacked 
# (i.e., not merging into "main" but into another PR)
# Removes label automatically once target branch is changed to "main"

name: Label Stacked PRs

on:
  pull_request:
    types: [synchronize, opened, reopened, edited, closed]

env:
  BASE_BRANCH: ${{ github.base_ref }}

jobs:
  remove-stacked-label:
    runs-on: ubuntu-latest
    steps:
      # https://github.com/marketplace/actions/actions-ecosystem-remove-labels
      - name: remove labels
        uses: actions-ecosystem/action-remove-labels@v1
        if: env.BASE_BRANCH == 'main'
        with:
          github_token: ${{ github.token }}
          labels: stacked PR

  add-stacked-label:
    runs-on: ubuntu-latest
    steps:
      # https://github.com/marketplace/actions/actions-ecosystem-add-labels
      - name: add labels
        uses: actions-ecosystem/action-add-labels@v1
        if: env.BASE_BRANCH != 'main'
        with:
          github_token: ${{ github.token }}
          labels: stacked PR
